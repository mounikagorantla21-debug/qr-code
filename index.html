<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan Student QR Code</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAEWAXI-ea_s9Mt5Ex3yTumsZr2xnDCY54",
      authDomain: "qrcode-f7215.firebaseapp.com",
      databaseURL: "https://qrcode-f7215-default-rtdb.firebaseio.com",
      projectId: "qrcode-f7215",
      storageBucket: "qrcode-f7215.appspot.com",
      messagingSenderId: "442167727446",
      appId: "1:442167727446:web:f4962eb6e18eaeb038b2f7",
      measurementId: "G-R6JDRDTG82"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    function fetchStudentByCode(code) {
      const dbRef = ref(database, 'students');
      get(dbRef).then((snapshot) => {
        if (snapshot.exists()) {
          let found = false;
          snapshot.forEach((childSnap) => {
            const student = childSnap.val();
            if (student.code === code) {
              found = true;
              document.getElementById('result').innerHTML = `
                <h3>Student Details</h3>
                <p><strong>Name:</strong> ${student.name}</p>
                <p><strong>Register Number:</strong> ${student.regNo}</p>
                <p><strong>Branch:</strong> ${student.branch}</p>
                <p><strong>Code:</strong> ${student.code}</p>
              `;
            }
          });
          if (!found) {
            document.getElementById('result').innerHTML = `<p style="color:red;">No student found for this code!</p>`;
          }
        } else {
          document.getElementById('result').innerHTML = `<p style="color:red;">No students in database!</p>`;
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      const html5QrCode = new Html5Qrcode("qr-reader");
      const qrConfig = { fps: 10, qrbox: 250 };

      html5QrCode.start(
        { facingMode: "environment" },
        qrConfig,
        (decodedText) => {
          // Stop scanning once QR code is detected
          html5QrCode.stop();
          fetchStudentByCode(decodedText);
        },
        (errorMessage) => {
          // console.log(`QR Code no read: ${errorMessage}`);
        }
      ).catch(err => console.error(err));
    });
  </script>
  <style>
    body { font-family: Arial; padding:20px; text-align:center; background:#f0f0f0; }
    #qr-reader { margin: auto; width: 300px; }
    #result { margin-top:20px; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); max-width:400px; margin-left:auto; margin-right:auto;}
  </style>
</head>
<body>
  <h2>Scan Student QR Code</h2>
  <div id="qr-reader"></div>
  <div id="result"></div>
</body>
</html>
